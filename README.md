# Проектная работа "Веб-ларек"

Приветствую, дорогой %Username%! Перед тобой моя реализация проекта "Веб-ларек". Вместе с тобой мы осуществим покупку невероятных товаров с Я.Склада(**Будь внимательней, это все понарошку**). При загрузке страницы ты увидишь список товаров. Ты можешь добавить в корзину любой товар, кроме тех что не имеют цены(**бесценны**). К сожалению товаров на складе не слишком много, и любой товар можно добавить только в единственном экземпляре. Но не волнуйся, я уверен что склад регулярно пополняется! После этого рекомендую заглянуть в корзину и попробовать оформить заказ (Большая красивая кнопка с текстом "Оформить"). В следующем окне необходимо выбрать способ оплаты (не страшно если забыл, по умолчанию выбрано "при получении". Вдруг ты не захочешь светить данными своей карты в неизвестном учебном проекте). После необходимо заполнить адрес, где бы ты хотел получить эти товары. На следующем экране нам понадобится от тебя адрес почты (обещаю не слать туда спам) и номер телефона (вдруг на складе что-то все же закончилось или будет необходимо что-то уточнить). Вот и все, заказ готов к оформлению, дружище! Жми кнопку оплатить(в этот момент желательно сказать: ***Торжественно клянусь что замышляю только шалость***). Если с интернетом все в порядке, товар заказан, с его ID ты можешь ознакомиться в консоли. Вперед к новым покупкам! 

Чуть ниже инструкция для запуска этого проекта, а так же его документация. Проект выполнен согласно парадигме **MVP:** 

- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

**Стек: HTML, SCSS, TS, Webpack**

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/common/ - папка для переиспользуемых родительских классов

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Карточка товара
```
export interface IProductCard {
    id: string
    title: string
    description?: string
    price: number
    image: string
    category?: string
}
```
тип для рендера карточки
```
export type ICard = Pick<IProductCard, 'title' | 'price' | 'category' | 'image' | 'id'>
```
Интерфейс для модели данных карточек
```
export interface ICardsData {
    cards: IProductCard[]
}
```
Тип для передачи адреса пользователя
```
export type address = {
    address: string
}
```
тип для передачи контактов пользователя
```
export type contacts = {
    email: string
    phone: string
}
```
Интерфейс для данных заказа
```
export interface IOrderDataPost {
    items: string[]
    payment: string
    email: string
    phone: string
    address: string
    total: number
}
```
интерфейс для ответа сервера
```
export interface IOrderResponse {
    id: string
    total: number
}
```

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Конструктор класса  `constructor(baseUrl: string, options: RequestInit = {})`- принимает базовый URL и глобальные опции для всех запросов(опционально).
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse(response: Response): Promise<object> ` - обрабатывает ответ сервера и возвращает ответ либо ошибку


#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Внутри конструктора `constructor() {this._events = new Map<EventName, Set<Subscriber>>();
	}` он инициализирует свойство _events как новый экземпляр Map для хранения информации о подписках на события
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек.
Конструктор класса `constructor(events: IEvents)`  принимает инстант брокера событий
В полях класса хранятся следующие данные:
- _cards: IProductCard[] - массив объектов карточек
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getCard(citem: string): IProductCard - возвращает карточку по ИД

Сеттеры  
 - cards(cards: IProductCard[]) - для заполнения массива карточек

Геттеры 
- cards(): IProductCard[] - для получения массива карточек

#### Класс BasketData
Класс отвечает за хранение товаров в корзине.
`constructor(events: IEvents)` - Конструктор класса принимает инстант брокера событий и обнуляет массив продуктов в корзине.
В полях класса хранятся следующие данные:
 - _products: IProductCard[] - список продуктов в корзине
 - events: IEvents -  экземпляр класса `EventEmitter` для инициации событий при изменении данных.
 Так же класс предоставляет набор методов для взаимодействия с этими данными. 
  - addToBasket(item: IProductCard): void - добавление продукта в корзину
  - delFromBasket(id: string): void  - удаление товара из корзины
  - getSum(): number  - складывает сумму цены товаров
  - convertToArrayId(value: IProductCard[]): string[] - превращает массив продуктов в массив строк называний ID
  - clear(): void очищает корзину
  
  `products()`   геттер для  получения списка продуктов в корзине

#### Класс OrderData
Класс отвечает за формирование и хранения данных заказа.
 ` constructor(events: IEvents)`  Конструктор класса принимает инстант брокера событий
В полях класса хранятся следующие данные:
 - _items: string[] - массив ID товаров в заказе
 - _payment = 'offline'; - выбор способа оплаты, по умолчанию "при получении"
 - _email: string; - адрес почты получателя заказа
 - _phone: string; - телефон получателя заказа 
 - _address: string; - адрес получателя заказа
 - _total: number; - общая сумма заказа
 - events: IEvents; - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
 - _totalResponse: number; - ответ  подтвержденной суммы заказа от сервера.

 Так же класс предоставляет набор методов для взаимодействия с этими данными:
 - getOrder(): IOrderDataPost - возвращает данные из заказа
 - clear(): void - очищает данные заказа.

 Сеттеры:
  - items(value: string[]) - задает массив ID товаров в заказе.
  - payment(value: string) - Задает тип оплаты, по умолчанию 'offline'.
  - email(value: string) - Задает адрес электронной почты покупателя.
  - phone(value: string) - Задает телефон покупателя.
  - address(value: string) - Задает адрес покупателя. 
  - total(value: number) - Задает общую сумму заказа.
  - totalResponse(value: number) - Задает подтвержденную сумму заказа после ответа сервера
  Геттеры: 
  totalResponse(): number - возвращает подтвержденную сервером  сумму заказа покупателя после покупки
  total(): number - возвращает сумму заказа.
  address(): string - возвращает адрес покупателя.
  phone(): string - возвращает телефонный номер покупателя.
  email(): string - возвращает адрес электронной почты покупателя.
  payment(): string - позвращает тип оплаты.
  items(): string[] - возвращает массив ID товаров.




 ### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. 
В конструктор `constructor(protected readonly container: HTMLElement)` принимает элемент разметки, являющийся основным родительским контейнером компонента. Методы:
 - render(data?: Partial<T>): HTMLElement - отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.
 - setImage(element: HTMLImageElement, src: string, alt?: string) - устанавливает изображение с алтернативным текстом
 - setVisible(element: HTMLElement) - добавляет свойство display для отображения элемента
 - setHidden(element: HTMLElement) - добавляет свойство none для скрытия элемента
 - setDisabled(element: HTMLElement, state: boolean) - задает и снимает атрибут 'disabled'
 - setText(element: HTMLElement, value: unknown) - Устанавливает текстовое содержимое элемента
 - toggleClass(element: HTMLElement, className: string, force?: boolean) - устанавливает и снимает класс с элемента


#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. Наследуется от абстрактного класса Component.  
- `constructor(container: HTMLElement, protected events: IEvents)` Конструктор принимает контейнер, по которому в разметке страницы будет открыто модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий. 
Поля класса
 - _closeButton: HTMLButtonElement - элемент кнопки
 - _content: HTMLElement  - контейнер для отрисовки окон
 Сеттер:
 -  content(value: HTMLElement) - задает контент для модального окна
 Методы:
 - open() - для открытия модального окна.
 - close() - закрытие модального окна.
 - render(data: IModalData): HTMLElement - отображение содержимого модального окна
 - handleEscUp(evt: KeyboardEvent) - закрытие модального окна кнопкой Esc

#### Класс  Form
Родительский класс форм.
конструктор `constructor(protected container: HTMLFormElement, protected events: IEvents)` принимает элемент формы и экземпляр класса Eventemitter для инициации событий
Поля: 
- _submit: HTMLButtonElement; - для кнопки подтверждения
- protected _errors: HTMLElement; - для сообщений об ошибке
Методы: 
- onInputChange(field: keyof T, value: string) - подписывается на событие изменения данных внутри поля ввода
- onSubmit<T extends object>(data: T) - подписка на события submit
- render(state: Partial<T> & IFormState)  - обновляет состояние формы и возвращает её контейнер
Сеттеры:
- errors(value: string) - задает текст ошибке валидации
- valid(value: boolean)  - меняет значение кнопки submit
 
#### Класс  Page 
Отображение страницы. Отвечает за изменения счетчика корзины и блокировку страницы во время открытия модальных окон. 
Конструктор `constructor(template: HTMLElement, events: IEvents)` принимает страницу и экземпляр класса `EventEmitter` для возможности инициации событий. 
Поля класса: 
 - headerBasket: HTMLElement - для элемента счетчика корзины
 - basketIcon: HTMLElement - для элемента корзины
 - wrapper: HTMLElement - элемент для фиксации прокручивания страницы
Сеттеры: 
- locked(value: boolean) - задает класс для блокировки страницы
- basketCounter(value: string) - задает колчество товаров в корзине

#### Класс  FormsView 
Отображает окно получения адреса доставки и способа оплаты. Содержит метод addressInputValidate(): void для валидации поля. Конструктор `constructor(container: HTMLFormElement, events: IEvents)` принимает контейнер с темплейтом формы и экземпляр класса `EventEmitter` для возможности инициации событий.  
Поля класса
- _address: HTMLInputElement; - форма input
- _buttonOnline: HTMLButtonElement - кнопка оплата картой
- _buttonOffline: HTMLButtonElement; - кнопка оплата при получении
- _buttonSubmit: HTMLButtonElement; - кнопка Далее
Методы: 
- addressInputValidate(): void - валидирует поле адрес
- render(state: Partial<IAddressFormView> & IFormState) - делегирует логику рендеринга родительскому классу и выполняет валидацию поля. 

#### Класс  BasketView 
Отображает содержимое корзины. Конструктор класса 
 `constructor(template: HTMLTemplateElement,events: IEvents, basketData: BasketData	)`  принимает контейнер с темлейтом, экземпляр класса `EventEmitter` для возможности инициации событий и экземпляр класса данных BasketData для возможности обновления отображения содержимого корзины.
     Содержит методы:
 - createCardHTML(product: IProductCard): string - для возвращения элемента карточки внутри корзины
 - updateList() - проверяет и обновляет содержимое корзины 

Поля класса
- _cards: HTMLUListElement; - элемент для размещения отображения товаров
- _button: HTMLButtonElement; - для элемента кнопки
- _total: HTMLElement - для элемента цены
- events: IEvents; - для событий
-  basketData: BasketData - для экземпляра корзины
- _emptyText: HTMLElement - для элемента пустой корзины
Сеттеры:
- total(value: string) - задает значение общей сумме покупки
- cards(value: HTMLUListElement) - заменяет текущие карточки новыми.

#### Класс  Card 
Отображает содержимое карточки. Конструктор класса `constructor(template: HTMLTemplateElement, events: IEvents)` принимает контейнер с темлпейтом и экземпляр класса `EventEmitter` для возможности инициации событий. 
Методы класса
 - handleCardClick  - подписывается на события выбора карточки
 - render(data: ICard) - отвечает за отрисовку карточки. 
 Поля класса 
- itemElement: HTMLElement - поле для элемента темплейта
- title: HTMLElement - поле для заголовка продукта
- price: HTMLElement - поле для цены продукта
- category: HTMLElement - поле для категории продукта
- image: HTMLElement - поле для изображения продукта
- id: string - поле для ID продукта
- events - поле для событий
 - _description - поле для описания продукта
 - _categoryColor - поле для хранения значений категорий для последующего добавления необходимого класса
 - _button - поле для кнопки submit
 Сеттеры: 
 - category(value: string) - для установки значения категории и установки класса
 - id(value: string)  - для установки значения ID товара
 - image(value: string) - для установки изображения товара
 - title(value: string) - для установки названия товара
 - price(value: number) - для установки цены товара
 Геттер: 
 - id() - для получения ID товара

#### Класс  ContactsFormView 
Отображает формы для сбора контактов покупателя. Конструктор класса `constructor(container: HTMLFormElement, events: IEvents) ` принимает контейнер с формой и экземпляр класса `EventEmitter` для возможности инициации событий. 
Поля класса: 
- formEmail: HTMLFormElement; - для инпута email
- formPhone: HTMLFormElement; - для инпута телефона
- errorEmail: HTMLSpanElement; - для ошибки валидации email
- errorPhone: HTMLSpanElement; - для ошибки валидации телефона


Методы класса 
 - emailValidate (): void - валидация input email
 - phoneValidate(): void  - валидация input телефона
 - chekValidation(): void  - проверяет что поля заполнены и включает или отключает кнопку далее


 #### Класс  PreviewCard 
 Наследуется от Card. Отображает выбранную карточку в модальном окне.  Конструктор класса `constructor(template: HTMLTemplateElement, events: IEvents)` принимает контейнер с темлпейтом и экземпляр класса `EventEmitter` для возможности инициации событий.  
 Поля класса 
 - _description: HTMLElement - описание продукта
 Сеттеры: 
 - price(value: number) - задает значение цене карточки и выключает кнопку добавления в корзину если цена null
 Метод: 
  - render(data: IProductCard) - отрисовывает карточку
 

  #### Класс   SuccessOrder
Отображает окно успешной покупки. Конструктор класса `constructor(container: HTMLTemplateElement, events: IEvents)` принимает контейнер с темлпейтом и экземпляр класса `EventEmitter` для возможности инициации событий. Содержит сеттер для изменения значения количество списанных денег. 
Поля класса 
- _title: HTMLElement - элемент заголовка
- _description: HTMLElement - элемент списанной цены за покупку
- _button: HTMLButtonElement - кнопка для завершения процесса покупки.
-  events: IEvents - для событий EventEmittera
Сеттер: 
- description(value: number) - задает значение списанных за заказ денег после ответа сервера


### Взаимодействие 
Взаимодействие между элементами происходит за счет собыйтийно-ориентированного подхода. Экземпляр EventEmitter позволяет подписаться на события и отследить когда событие происходит. Список основных событий приложения:
- 'cards:added' - карточки загрузились и мы выводим их на страницу
- 'cards:chosen' - пользователь выбрал карточку с товаром 
- 'modal:open' - открылось модальное окно
- 'modal:close' - модальное окно закрылось
- 'product:addedtobasket' - продукт добавлен в корзину
- 'basket:delItem' - товар удален из корзины
- 'basket:addedToOrder' - в корзине нажата кнопка оформить
- 'addressform:online' - выбран способ оплаты картой
- 'addressform:offline' - выбран способ оплаты при получении
- 'addressform:submit' - пользователь заполнил адрес и нажал далее
- 'contacts:submit' пользователь заполнил почту и телефон и нажал далее
- 'order:success' - пользователь нажал "за новыми покупками"