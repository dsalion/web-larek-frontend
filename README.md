# Проектная работа "Веб-ларек"

Приветствую, дорогой %Username%! Перед тобой моя реализация проекта "Веб-ларек". Вместе с тобой мы осуществим покупку невероятных товаров с Я.Склада(**Будь внимательней, это все понарошку**). При загрузке страницы ты увидишь список товаров. Ты можешь добавить в корзину любой товар, кроме тех что не имеют цены(**бесценны**). К сожалению товаров на складе не слишком много, и любой товар можно добавить только в единственном экземпляре. Но не волнуйся, я уверен что склад регулярно пополняется! После этого рекомендую заглянуть в корзину и попробовать оформить заказ (Большая красивая кнопка с текстом "Оформить"). В следующем окне необходимо выбрать способ оплаты (не страшно если забыл, по умолчанию выбрано "при получении". Вдруг ты не захочешь светить данными своей карты в неизвестном учебном проекте). После необходимо заполнить адрес, где бы ты хотел получить эти товары. На следующем экране нам понадобится от тебя адрес почты (обещаю не слать туда спам) и номер телефона (вдруг на складе что-то все же закончилось или будет необходимо что-то уточнить). Вот и все, заказ готов к оформлению, дружище! Жми кнопку оплатить(в этот момент желательно сказать: ***Торжественно клянусь что замышляю только шалость***). Если с интернетом все в порядке, товар заказан, с его ID ты можешь ознакомиться в консоли. Вперед к новым покупкам! 

Чуть ниже инструкция для запуска этого проекта, а так же его документация. Проект выполнен согласно парадигме **MVP:** 

- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

**Стек: HTML, SCSS, TS, Webpack**

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/common/ - папка для переиспользуемых родительских классов

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Карточка товара
```
export interface IProductCard {
    id: string
    title: string
    description: string
    price: number
    image: string
    category: string
}
```
тип для рендера карточки
```
export type ICard = Pick<IProductCard, 'title' | 'price' | 'category' | 'image' | 'id'>
```
Интерфейс для модели данных карточек
```
export interface ICardsData {
    cards: IProductCard[]
}
```
Тип для передачи адреса пользователя
```
export type address = {
    address: string
}
```
тип для передачи контактов пользователя
```
export type contacts = {
    email: string
    phone: string
}
```
Интерфейс для данных заказа
```
export interface IOrderDataPost {
    items: string[]
    payment: string
    email: string
    phone: string
    address: string
    total: number
}
```
интерфейс для ответа сервера
```
export interface IOrderResponse {
    id: string
    total: number
}
```

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек.
Конструктор класса принимает инстант брокера событий
В полях класса хранятся следующие данные:
- _cards: IProductCard[] - массив объектов карточек
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getCard(citem: string): IProductCard - возвращает карточку по ИД
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс BasketData
Класс отвечает за хранение товаров в корзине.
Конструктор класса принимает инстант брокера событий и обнуляет массив продуктов в корзине.
В полях класса хранятся следующие данные:
 - _products: IProductCard[] - список продуктов в корзине
 - events: IEvents -  экземпляр класса `EventEmitter` для инициации событий при изменении данных.
 Так же класс предоставляет набор методов для взаимодействия с этими данными. 
  - addToBasket(item: IProductCard): void - добавление продукта в корзину
  - delFromBasket(id: string): void  - удаление товара из корзины
  - getSum(): number  - складывает сумму цены товаров
  - convertToArrayId(value: IProductCard[]): string[] - превращает массив продуктов в массив строк называний ID
  - clear(): void очищает корзину
  а так-же  геттер для  получения списка продуктов в корзине
#### Класс OrderData
Класс отвечает за формирование и хранения данных заказа.
Конструктор класса принимает инстант брокера событий
В полях класса хранятся следующие данные:
 - _items: string[] - массив ID товаров в заказе
 - _payment = 'offline'; - выбор способа оплаты, по умолчанию "при получении"
 - _email: string; - адрес почты получателя заказа
 - _phone: string; - телефон получателя заказа 
 - _address: string; - адрес получателя заказа
 - _total: number; - общая сумма заказа
 - events: IEvents; - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
 - _totalResponse: number; - ответ  подтвержденной суммы заказа от сервера. 
 Так же класс предоставляет набор методов для взаимодействия с этими данными.
 - getOrder(): IOrderDataPost - возвращает данные из заказа
 - clear(): void - очищает данные заказа.
 - а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

 ### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. Наследуется от абстрактного класса Component.  
- constructor(container: HTMLElement, protected events: IEvents) Конструктор принимает контейнер, по которому в разметке страницы будет открыто модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий. 
Поля класса
 - _closeButton: HTMLButtonElement - элемент кнопки
 - _content: HTMLElement  - контейнер для отрисовки окон

 
#### Класс  FormsView 
Отображает окно получения адреса доставки и способа оплаты. Содержит метод addressInputValidate(): void для валидации поля. Конструктор принимает контейнер с темплейтом и экземпляр класса `EventEmitter` для возможности инициации событий.  
Поля класса
- _address: HTMLInputElement; - форма input
- _buttonOnline: HTMLButtonElement - кнопка оплата картой
- _buttonOffline: HTMLButtonElement; - кнопка оплата при получении
- _buttonSubmit: HTMLButtonElement; - кнопка Далее
- errors: HTMLSpanElement - span с ошибкой валидации

#### Класс  BasketView 
Отображает содержимое корзины. Конструктор класса принимает контейнер с темлейтом, экземпляр класса `EventEmitter` для возможности инициации событий и экземпляр класса данных BasketData для возможности обновления отображения содержимого корзины. Содержит методы
 - createCardHTML(product: IProductCard): string - для возвращения элемента карточки внутри корзины
 - updateList() - проверяет и обновляет содержимое корзины 

Поля класса
- _cards: HTMLUListElement; - элемент для размещения отображения товаров
- _button: HTMLButtonElement; - для элемента кнопки
- _total: HTMLElement - для элемента цены
- events: IEvents; - для событий
-  basketData: BasketData - для экземпляра корзины
- _emptyText: HTMLElement - для элемента пустой корзины

#### Класс  Card 
Отображает содержимое карточки. КОнструктор класса принимает контейнер с темлпейтом и экземпляр класса `EventEmitter` для возможности инициации событий. 
Методы класса
 - setButtonsColor() - отвечает за установку цвета кнопок категорий карточек
 - render(data: ICard) - отвечает за отрисовку карточки. 
 Поля класса 
- itemElement: HTMLElement - поле для элемента темплейта
- title: HTMLElement - поле для названия продукта
- price: HTMLElement - поле для цены продукта
- category: HTMLElement - поле для категории продукта
- image: HTMLElement - поле для изображения продукта
- id: string - поле для ID продукта

#### Класс  ContactsFormView 
Отображает формы для сбора контактов покупателя. Конструктор класса принимает контейнер с темлпейтом и экземпляр класса `EventEmitter` для возможности инициации событий. 
Методы класса 
 - emailValidate (): void - валидация input email
 - phoneValidate(): void  - валидация input телефона
 - chekValidation(): void  - проверяет что поля заполнены и включает или отключает кнопку далее

 #### Класс  PreviewCard 
 Отображает выбранную карточку в модальном окне.  Конструктор класса принимает контейнер с темлпейтом и экземпляр класса `EventEmitter` для возможности инициации событий. Содержит геттеры и сеттеры  для записи и получения данных из полей. 
 Поля класса 
 - _category: HTMLElement - категория продукта
 - _title: HTMLElement - название продукта
 - _description: HTMLElement - описание продукта
 - _image: HTMLElement - изображение продукта
 - _button: HTMLButtonElement - кнопка продукта
 - _price: HTMLElement - цена продукта
 - _id: string - ID продукта

  #### Класс   SuccessOrder
Отображает окно успешной покупки. Конструктор класса принимает контейнер с темлпейтом и экземпляр класса `EventEmitter` для возможности инициации событий. Содержит сеттер для изменения значения количество списанных денег. 
Поля класса 
- _title: HTMLElement - элемент заголовка
- _description: HTMLElement - элемент списанной цены за покупку
- _button: HTMLButtonElement - кнопка для завершения процесса покупки. 

### Взаимодействие 
Взаимодействие между элементами происходит за счет собыйтийно-ориентированного подхода. Экземпляр EventEmitter позволяет подписаться на события и отследить когда событие происходит. Список основных событий приложения:
- 'cards:added' - карточки загрузились и мы выводим их на страницу
- 'cards:chosen' - пользователь выбрал карточку с товаром 
- 'modal:open' - открылось модальное окно
- 'modal:close' - модальное окно закрылось
- 'product:addedtobasket' - продукт добавлен в корзину
- 'basket:delItem' - товар удален из корзины
- 'basket:addedToOrder' - в корзине нажата кнопка оформить
- 'addressform:online' - выбран способ оплаты картой
- 'addressform:offline' - выбран способ оплаты при получении
- 'addressform:submit' - пользователь заполнил адрес и нажал далее
- 'contacts:submit' пользователь заполнил почту и телефон и нажал далее
- 'order:success' - пользователь нажал "за новыми покупками"